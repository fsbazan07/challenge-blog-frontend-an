<section class="w-full rounded-2xl bg-card shadow-xl dark:shadow-black/30">
  <div class="p-6 sm:p-8 space-y-6">
    <div class="space-y-1">
      <h2 class="text-lg font-semibold text-foreground">Contenido</h2>
      <p class="text-sm text-muted-foreground">Completá los campos para darle forma a tu post.</p>
    </div>

    <div class="flex flex-col gap-2">
      <label for="title" class="text-sm text-muted-foreground">Título *</label>
      <input
        id="title"
        [value]="vm.title"
        [appInputGuard]="ngGuards.postTitle"
        guardMode="sanitize"
        (input)="titleChange.emit($any($event.target).value)"
        placeholder="Ej: Cómo estructuré mi primer proyecto en NestJS"
        class="w-full rounded-xl border border-border bg-muted px-4 py-3 text-sm text-foreground outline-none focus:ring-2 focus:ring-ring"
      />
      @if (vm.titleError) {
        <p class="text-sm text-destructive">{{ vm.titleError }}</p>
      }
    </div>

    <div class="flex flex-col gap-2">
      <label for="excerpt" class="text-sm text-muted-foreground">Resumen</label>
      <textarea
        id="excerpt"
        [value]="vm.excerpt"
        [appInputGuard]="ngGuards.postExcerpt"
        guardMode="sanitize"
        (input)="excerptChange.emit($any($event.target).value)"
        placeholder="Un resumen corto para el feed (opcional)"
        rows="3"
        class="w-full resize-none rounded-xl border border-border bg-muted px-4 py-3 text-sm text-foreground outline-none focus:ring-2 focus:ring-ring"
      ></textarea>
    </div>

    <div class="flex flex-col gap-2">
      <label for="content" class="text-sm text-muted-foreground">Contenido *</label>
      <textarea
        id="content"
        [value]="vm.content"
        [appInputGuard]="ngGuards.postContent"
        guardMode="sanitize"
        (input)="contentChange.emit($any($event.target).value)"
        placeholder="Escribí tu post acá..."
        rows="10"
        class="w-full resize-none rounded-xl border border-border bg-muted px-4 py-3 text-sm text-foreground outline-none focus:ring-2 focus:ring-ring"
      ></textarea>
      @if (vm.contentError) {
        <p class="text-sm text-destructive">{{ vm.contentError }}</p>
      }
    </div>

    <div class="flex flex-col gap-2">
      <label for="tags" class="text-sm text-muted-foreground">Tags</label>
      <input
        id="tags"
        [value]="vm.tagsInput"
        [appInputGuard]="ngGuards.alphaNumericSpaces"
        guardMode="sanitize"
        (input)="tagsInputChange.emit($any($event.target).value)"
        placeholder="Ej: react, nestjs, typescript (separados por coma)"
        class="w-full rounded-xl border border-border bg-muted px-4 py-3 text-sm text-foreground outline-none focus:ring-2 focus:ring-ring"
      />

      @if (vm.tags.length > 0) {
        <div class="flex flex-wrap gap-2 pt-2">
          @for (t of vm.tags; track t) {
            <span
              class="inline-flex items-center gap-2 rounded-full bg-accent px-3 py-1 text-xs text-accent-foreground"
            >
              {{ t }}
              <button
                type="button"
                class="opacity-70 hover:opacity-100"
                (click)="removeTag.emit(t)"
                [attr.aria-label]="'Quitar tag ' + t"
              >
                x
              </button>
            </span>
          }
        </div>
      }
    </div>

    <div class="space-y-1.5">
      <label for="cover" class="text-sm text-muted-foreground">Portada</label>

      <div
        (drop)="coverDrop.emit($event)"
        (dragover)="coverDragOver.emit($event)"
        (dragenter)="coverDragEnter.emit($event)"
        (dragleave)="coverDragLeave.emit($event)"
        class="relative rounded-2xl border border-dashed border-border bg-muted/60 p-4 transition-colors"
        [class.ring-2]="vm.isDraggingCover"
        [class.ring-ring]="vm.isDraggingCover"
        [class.bg-muted]="vm.isDraggingCover"
      >
        <input
          id="cover"
          type="file"
          accept="image/png,image/jpeg,image/webp"
          class="absolute inset-0 opacity-0 cursor-pointer"
          aria-label="Subir imagen de portada"
          (change)="onFileChange($event)"
        />

        <div class="flex flex-col items-center justify-center gap-2 text-center">
          @if (vm.coverPreviewUrl) {
            <ng-container>
              <img
                [src]="vm.coverPreviewUrl"
                alt="Preview portada"
                class="h-40 w-full rounded-xl object-cover border border-border"
              />
              <div class="flex items-center gap-2">
                <app-button type="button" variant="secondary" (click)="clearCover.emit()">
                  Quitar
                </app-button>
              </div>
            </ng-container>
          } @else {
            <ng-container>
              <div class="text-sm text-foreground font-medium">
                Arrastrá una imagen acá o hacé click para seleccionar
              </div>
              <div class="text-xs text-muted-foreground">JPG, PNG o WEBP — máx 5MB</div>
            </ng-container>
          }
        </div>
      </div>

      @if (vm.coverError) {
        <p class="text-sm text-destructive">{{ vm.coverError }}</p>
      }
    </div>

    @if (vm.mode === 'edit') {
      <div class="flex gap-2">
        <app-button variant="secondary" [disabled]="vm.isSubmitting" (click)="update.emit()">
          @if (vm.isSubmitting) {
            <app-dots-loader />
          } @else {
            Guardar cambios
          }
        </app-button>
        <app-button variant="primary" [disabled]="vm.isSubmitting" (click)="publish.emit()">
          @if (vm.isSubmitting) {
            <app-dots-loader />
          } @else {
            Publicar
          }
        </app-button>
      </div>
    } @else {
      <div class="flex gap-2">
        <app-button variant="secondary" [disabled]="vm.isSubmitting" (click)="saveDraft.emit()">
          @if (vm.isSubmitting) {
            <app-dots-loader />
          } @else {
            Guardar borrador
          }
        </app-button>
        <app-button variant="primary" [disabled]="vm.isSubmitting" (click)="publish.emit()">
          Publicar
        </app-button>
      </div>
    }
  </div>
</section>
